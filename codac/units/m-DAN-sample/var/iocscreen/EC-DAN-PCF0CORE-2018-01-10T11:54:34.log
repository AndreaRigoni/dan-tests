#!../../bin/linux-x86_64/EC-DAN
#+======================================================================
# $HeadURL: https://svnpub.iter.org/codac/iter/codac/dev/units/m-epics-iter-templates/tags/CODAC-CORE-5.4.0/templates/genericBoot/ioc/st.cmd $
# $Id: st.cmd 75208 2017-02-03 09:19:23Z cesnikt $
#
# Project       : CODAC Core System
#
# Description   : ITER ioc template EPICS start up file
#
# Author(s)     : This file was generated by CODAC development toolkit
#
# Copyright (c) : 2010-2017 ITER Organization,
#                 CS 90 046
#                 13067 St. Paul-lez-Durance Cedex
#                 France
#
# This file is part of ITER CODAC software.
# For the terms and conditions of redistribution or use of this software
# refer to the file ITER-LICENSE.TXT located in the top level directory
# of the distribution package.
#
#-======================================================================
< envPaths
epicsEnvSet("IOC","iocEC-DAN-PCF0CORE")
epicsEnvSet("TOP","/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics")
epicsEnvSet("EPICS_BASE","/opt/codac-5.4/epics")
< envSystem
############################################################################
## CODAC specific environment variables
############################################################################
epicsEnvSet("AUTOSAVE_SYSM_PV_PREFIX","EC-DAN-SYSM:F0CORE-")
epicsEnvSet("IOCSH_PS1","iocEC-DAN-PCF0CORE> ")
epicsEnvSet("STREAM_PROTOCOL_PATH","/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/db:/opt/codac-5.4/epics/db")
#- End-of-file marker - do not delete or add lines below!
< envUser
############################################################################
## User provided environment variables
############################################################################
#epicsEnvSet("EPICS_CA_SERVER_PORT", "5064")
#epicsEnvSet("EPICS_CA_ADDR_LIST", "")
#epicsEnvSet("EPICS_CA_AUTO_ADDR_LIST", "YES")
#- End-of-file marker - do not delete or add lines below!
cd "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics"
############################################################################
## Register all support components
############################################################################
dbLoadDatabase "dbd/EC-DAN.dbd"
EC_DAN_registerRecordDeviceDriver pdbbase
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/sddPreDriverConf.cmd"
#======================================================================
# PLC(s) driver configuration commands
#======================================================================
# level=-1:  no output
# level=0:   errors only
# level=1:   startup messages
# level=2: + output record processing
# level=3: + input record processing
# level=4: + driver calls
# level=5: + io printout
# be careful using level>1 since many messages may introduce delays
# var s7plcDebug 2
# s7plcConfigure name,IPaddr,port,inSize,outSize,bigEndian,recvTimeout,sendIntervall, configversion
# connects to PLC <name> on address <IPaddr> port <port>
# <inSize>        : size of data block PLC -> IOC [bytes]
# <outSize>       : size of data block IOC -> PLC [bytes]
# <bigEndian>=1   : motorola format data (MSB first)
# <bigEndian>=0   : intel format data (LSB first)
# <recvInterval>  : receive buffer interval [ms] (Default : 50ms)
# <sendIntervall> : time to wait before sending new data to PLC [ms]
# <configversion> : database configuration version
# s7plcConfigureCmd name,IPaddr,port,outSize,bigEndian,sendIntervall
# connects to PLC <name> on address <IPaddr> port <port>
# <outSize>       : size of data block IOC -> PLC [bytes]
# <bigEndian>=1   : motorola format data (MSB first)
# <bigEndian>=0   : intel format data (LSB first)
# <sendIntervall> : time to wait before sending new data to PLC [ms]
#============================================================================
# s7plc asyn driver configuration commands
#============================================================================
#============================================================================
# NI-6259 DAQ I/O Module driver configuration commands
#============================================================================
# Reference: ITER_D_3DEY52 v1.3 - NI PXI-6259 EPICS Driver User’s Guide
# For analogue input, analogue output, waveform, initialize using below function
# pxi6259_ai_init(uint8 cardnumber, uint32 range, uint32 clk_source, uint32 clk_edge);
# Example: pxi6259_ai_init(0, 1, 0, 0)
# For binary input, binary output, multi-bit binary input, multi bit binary output, initialize using below function
# pxi6259init(uint8 cardnumber, uint32 portmask0, uint8 portmask1, uint8 portmask2);
# Example: pxi6259_bio_init(0, 0xFF000000, 0xFF, 0xFF)
#============================================================================
# NI-6682 Timing and Synchronization I/O Module driver configuration commands
#============================================================================
# Reference ITER_D_33Q5TX v1.7 - NI Sync EPICS Driver User’s Guide 
# nisyncDrvInit(string port, char* type, int cardNumber);
# Example: nisyncDrvInit("S0", "PXI-6682", "0");
# Example: nisyncDrvInit("S0", "PXI-6683H", "0");
# nisyncTimeInit(int cardID, char* type, int cardNumber);
# Example: nisyncTimeInit("0", "PXI-6682", "0")
# Example: nisyncTimeInit("0", "PXI-6683H", "0")
#============================================================================================
# NI-6368 X Series - Multifunction Data Acquisition I/O Module driver configuration commands
#============================================================================================
# Reference ITER_D_3P4N3R v1.2 - NI X Series EPICS Driver User’s Guide 
# nixseriesInit(char *portName, char *nix6368Card);
# Example: nixseriesInit("ni6368_0", "/dev/ni6368.0");
#============================================================================
# NI-6528 DAQ I/O Module driver configuration commands
#============================================================================
# Reference ITER_D_433VEW - NI PXI-6528 EPICS Driver User's Manual
# ni6528_init(char *portName, char *ni6528Card); 
# Example: pxi6528_init("ni6528_0", "/dev/ni6528.0")
# asynSetTraceMask("<port name>",0,255)
# Example: asynSetTraceMask("pxi6528_0",0,255)
# pxi6528_reset(char *portName)
# Example: pxi6528_reset("pxi6528_0")
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/userPreDriverConf.cmd"
############################################################################
## User provided PLC or fast controller driver pre configuration
############################################################################
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/threadSchedulingConf.cmd"
############################################################################
## Thread scheduling configuration for real-time tuning
############################################################################
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/dbToLoad.cmd"
#======================================================================
# IOC Monitor
#======================================================================
cd /opt/codac-5.4/epics/db
dbLoadRecords("iocmon.db","CBS=EC-DAN-, CTRLTYPE=F, IDX=0, IOCTYPE=CORE")
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/iocEC-DAN-PCF0CORE-preSaveRestore.cmd"
############################################################################
## Save and restore
############################################################################
### save_restore setup
# status-PV prefix
save_restoreSet_status_prefix("EC-DAN-SYSM:F0CORE-")
# Use status-PV 
save_restoreSet_UseStatusPVs(1)
# Debug-output level
save_restoreSet_Debug(0)
# Ok to save/restore save sets with missing values (no CA connection to PV)?
save_restoreSet_IncompleteSetsOk(1)
# Save dated backup files?
save_restoreSet_DatedBackupFiles(1)
# Number of sequenced backup files to write
save_restoreSet_NumSeqFiles(3)
# Time interval between sequenced backups
save_restoreSet_SeqPeriodInSeconds(300)
# specify where save files should be
set_savefile_path("/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/")
# specify what save files should be restored.  Note these files must be
# in the directory specified in set_savefile_path(), or, if that function
# has not been called, from the directory current when iocInit is invoked
# Save files associated with the request files 'auto-output.req' and
# 'auto-input.req'.  These files are the standard way to use autosave 
 
set_pass1_restoreFile("iocEC-DAN-PCF0CORE.sav")
# specify directories in which to to search for included request files
set_requestfile_path("./")
dbLoadRecords("/opt/codac-5.4/epics/db/save_restoreStatus.db", "P=EC-DAN-SYSM:F0CORE-")
#- End-of-file marker - do not delete or add lines below!
############################################################################
## IOC Logging
############################################################################
iocLogInit
log client: connected to log server at "127.0.0.1:6500"
iocLogPrefix "11749.iocEC-DAN-PCF0CORE : "
############################################################################
## IOC initialization
############################################################################
cd "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/db"
Invalid directory path, ignored
iocInit
Starting iocInit
############################################################################
## EPICS R3.15.5
## EPICS Base built Feb 20 2017
############################################################################
reboot_restore: entry for file 'iocEC-DAN-PCF0CORE.sav'
reboot_restore: Found filename 'iocEC-DAN-PCF0CORE.sav' in restoreFileList.
*** restoring from '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav' at initHookState 7 (after record/device init) ***
save_restore: Can't open file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav'.
save_restore: Trying backup file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.savB'
save_restore: Can't open file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.savB'.
save_restore: Can't figure out which seq file is most recent,
save_restore: so I'm just going to start with '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav0'.
save_restore: Trying backup file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav0'
save_restore: Can't open file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav0'.
save_restore: Trying backup file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav1'
save_restore: Can't open file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav1'.
save_restore: Trying backup file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav2'
save_restore: Can't open file '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav2'.
save_restore: Can't find a file to restore from...save_restore: ...last tried '/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/autosave/iocEC-DAN-PCF0CORE.sav2'. I give up.
save_restore: **********************************

save_restore: Can't open save file.iocRun: All initialization complete
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/iocEC-DAN-PCF0CORE-postSaveRestore.cmd"
############################################################################
## Autosave monitor post setup
############################################################################
cd "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE"
create_monitor_set("iocEC-DAN-PCF0CORE.req",30,"P=EC-DAN-SYSM:F0CORE-")
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/sddSeqToLoad.cmd"
iocEC-DAN-PCF0CORE.sav: 0 of 0 PV's connected
############################################################################
## SDD provided sequence programs to load
############################################################################
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/seqToLoad.cmd"
############################################################################
## Sequence programs to load
############################################################################
## Start any sequence programs
#seq sncxxx,"user=andreaHost"
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/sddPostDriverConf.cmd"
############################################################################
## SDD provided PLC or fast controller driver post configuration
############################################################################
#- End-of-file marker - do not delete or add lines below!
< "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/target/main/epics/iocBoot/iocEC-DAN-PCF0CORE/userPostDriverConf.cmd"
############################################################################
## User provided PLC or fast controller driver post configuration
############################################################################
#- End-of-file marker - do not delete or add lines below!
dbl > "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/iocdump//EC-DAN-PCF0CORE-2018-01-10T11:54:34.dbl"
dbior > "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/iocdump//EC-DAN-PCF0CORE-2018-01-10T11:54:34.dbior"
dbhcr > "/home/andrea/devel/codac/dan-tests/codac/units/m-DAN-sample/var/iocdump//EC-DAN-PCF0CORE-2018-01-10T11:54:34.dbhcr"
#- End-of-file marker - do not delete or add lines below!
iocEC-DAN-PCF0CORE> 